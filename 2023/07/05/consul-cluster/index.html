<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <meta name="description" content="世事一场大梦，人生几度秋凉？夜来风叶已鸣廊。看取眉头鬓上。酒贱常愁客少，月明多被云妨。中秋谁与共孤光。把盏凄然北望。">
  
  <title>
    consul cluster |
    
    Ilak
  </title>
  <!-- Icon -->
  
    <link rel="shortcut icon" href="/favicon.ico">
    
  
<link rel="stylesheet" href="/css/style.css">

  
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Ilak" type="application/atom+xml">
</head>

<body>
  <main class="content">
    <section class="outer">
  <article id="post-consul-cluster" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      
  
  <h1 class="article-title" itemprop="name">
    consul cluster
  </h1>
  
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2023/07/05/consul-cluster/" class="article-date">
  <time datetime="2023-07-05T05:57:02.000Z" itemprop="datePublished">2023-07-05</time>
</a>
      
    </div>
    

    
    
<div class="tocbot"></div>

    

    <div class="article-entry" itemprop="articleBody">
      
      
      
        <h1 id="consul"><a href="#consul" class="headerlink" title="consul"></a>consul</h1><h2 id="consul-agent-register-service"><a href="#consul-agent-register-service" class="headerlink" title="consul agent register service"></a>consul agent register service</h2><p><a target="_blank" rel="noopener" href="https://developer.hashicorp.com/consul/commands/services">https://developer.hashicorp.com/consul/commands/services</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning for Consul operators: The Consul agent persists registered services in the local state directory. If this state directory is deleted or lost, services registered with this command will need to be reregistered.</span><br></pre></td></tr></table></figure>
<h2 id="why-consul-did’t-sync-svc-data"><a href="#why-consul-did’t-sync-svc-data" class="headerlink" title="why consul did’t sync svc data"></a>why consul did’t sync svc data</h2><p><a target="_blank" rel="noopener" href="https://github.com/hashicorp/consul/issues/11438">https://github.com/hashicorp/consul/issues/11438</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">For example, say you have nodes 1 and 2 in your environment, and two services�Cservice A and service B. Service A is deployed on both nodes 1 and 2, and separately registered with each node.</span><br><span class="line"></span><br><span class="line">Service B issues a service discovery query to Consul for service A, and Consul returns the IP/port info of the service running on both node 1 and 2.</span><br><span class="line"></span><br><span class="line">If node 1 goes down, the health check for service instance A on that machine will be marked as failed. As such, Consul&#x27;s catalog will no longer return information for the instance of service A running on node 1. It will only return information about the remaining healthy instance that is registered and still running on node 2.</span><br><span class="line"></span><br><span class="line">In order to have a service be highly available, you need to run the service across multiple nodes, and ensure the service is properly registered with its local node so that the particular service instance is discoverable in the service catalog.</span><br><span class="line"></span><br><span class="line">See Introduction to HashiCorp Consul for a visual explanation of this�Cstarting at the 5min mark through 6:25.</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=mxeMdl0KvBI&t=302s">https://www.youtube.com/watch?v=mxeMdl0KvBI&amp;t=302s</a></p>
<h2 id="how-to-use-consul-cluster"><a href="#how-to-use-consul-cluster" class="headerlink" title="how to use consul cluster"></a>how to use consul cluster</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/bluersw/p/11610711.html">https://www.cnblogs.com/bluersw/p/11610711.html</a><br>server test<br><img src="/2023/07/05/consul-cluster/server_test.gif"><br>client test<br><img src="/2023/07/05/consul-cluster/client_test.gif"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.ilak.website/2023/07/05/consul-cluster/" data-id="cljpb70du00007knjgidf9m0k" class="article-share-link">
        Share
      </a>
      
    </footer>

  </div>

  
  
<nav class="article-nav">
  
  
  <a href="/2023/05/30/work-schedule/" class="article-nav-link">
    <strong class="article-nav-caption">Older</strong>
    <div class="article-nav-title">work_schedule</div>
  </a>
  
</nav>

  

  
  
  
<div class="gitalk" id="gitalk-container"></div>

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">


<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>


<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>

<script type="text/javascript">
  var gitalk = new Gitalk({
    clientID: 'dcecf7086556839934c8',
    clientSecret: '03265ecdcf7197609a6ef31713a31cb885ba61c4',
    repo: 'gittalk',
    owner: 'ilak-0',
    admin: ['ilak-0'],
    // id: location.pathname,      // Ensure uniqueness and length less than 50
    id: md5(location.pathname),
    distractionFreeMode: false,  // Facebook-like distraction free mode
    pagerDirection: 'last'
  })

  gitalk.render('gitalk-container')
</script>

  

</article>
</section>
    <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>Ilak &copy; 2023</li>
      
        <li>
          
            <a href="https://beian.miit.gov.cn/" target="_blank"></a>
            
        </li>
      
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>theme  <a target="_blank" rel="noopener" href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
    <p><ul class="list-inline">
  
  <li><i class="fe fe-smile-alt tooltip" data-tooltip="UV"></i> <span id="busuanzi_value_site_uv"></span></li>
  
  <li><i class="fe fe-bookmark tooltip" data-tooltip="PV"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul></p>
  </div>
</footer>
  </main>
  <aside class="sidebar">
    <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/proto.jpg" alt="Ilak"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">文档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/gallery">相册</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="Search">
        <i class="fe fe-search"></i>
        Search
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="fe fe-feed"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
  </aside>
  
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>





<script src="/js/tocbot.min.js"></script>


<script>
  // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
  tocbot.init({
    tocSelector: '.tocbot',
    contentSelector: '.article-entry',
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    hasInnerContainers: true,
    scrollSmooth: true,
    positionFixedSelector: '.tocbot',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
  });
</script>



<script src="/js/ocean.js"></script>

</body>

</html>